# Auto Body Repair Assistant

Мультиплатформенное приложение для помощи сотрудникам кузовного цеха в диагностике деформаций кузова автомобиля.

## Основные возможности

- Визуализация силового каркаса кузова в 2D и 3D режимах
- Адаптивная математическая модель каркаса на основе реальных параметров автомобиля
- Ввод заводских размеров и фактических размеров после ДТП
- Наложение двух моделей для визуального сравнения деформаций
- Цветовая индикация отклонений и типов элементов каркаса
- Генерация отчетов
- База шаблонов популярных моделей автомобилей (Toyota Camry XV70)

## Технологический стек

- **Frontend**: Flutter (iOS, Android, Web, Desktop)
- **3D визуализация**: Собственная реализация без внешних 3D библиотек (CustomPainter + vector_math)
- **База данных**: SQLite (sqflite) + Hive для локального хранения
- **State Management**: Riverpod
- **Backend**: Firebase (опционально для синхронизации)

## Структура проекта

```
lib/
├── main.dart
├── core/
│   ├── models/           # Модели данных (Project, CarModel, Measurement)
│   ├── geometry/         # Адаптивная геометрия каркаса
│   ├── services/         # Сервисы приложения
│   ├── data/            # Шаблоны автомобилей (Toyota Camry)
│   └── utils/           # Утилиты
├── features/
│   ├── home/            # Главный экран приложения
│   ├── measurement/     # Ввод и обработка измерений
│   ├── visualization/   # 2D и 3D визуализация
│   │   └── widgets/
│   │       ├── car_body_2d_view.dart      # 2D вид
│   │       ├── adaptive_chassis_3d.dart   # Адаптивный 3D каркас
│   │       └── car_chassis_3d.dart        # Статический 3D каркас
│   ├── comparison/      # Сравнение моделей
│   └── reports/         # Генерация отчетов
└── shared/
    ├── widgets/         # Общие виджеты
    └── themes/          # Темы приложения
```

## Запуск приложения

### Веб-версия (рекомендуется)

1. Установите зависимости:
   ```bash
   flutter pub get
   ```

2. Запустите приложение:
   ```bash
   flutter run -d chrome
   ```
   
   Или используйте скрипт для автоматического открытия:
   ```bash
   python open_in_browser.py
   ```

### Десктопная версия (Windows)

1. Проверьте готовность системы:
   ```bash
   flutter doctor -v
   ```

2. Запустите приложение:
   ```bash
   flutter run -d windows
   ```

**Примечание**: Если возникают проблемы со сборкой для Windows, смотрите [DESKTOP_APP_INSTRUCTIONS.md](DESKTOP_APP_INSTRUCTIONS.md)

### Мобильные платформы

- **Android**: `flutter run -d android`
- **iOS**: `flutter run -d ios` (требуется macOS)

## Функции приложения

### 2D/3D визуализация
- Переключение между 2D и 3D режимами
- Вращение и масштабирование 3D модели
- Адаптивная геометрия каркаса с математической моделью "корыта"
- Цветовая индикация типов элементов каркаса:
  - Зеленый: передние лонжероны (подрамник)
  - Синий: задние лонжероны
  - Красный: пороги
  - Темно-синий: центральный тоннель
  - Серый: поперечины
- Реалистичная иерархия высот элементов:
  - Центральный тоннель: 1.3x высоты порогов
  - Пороги: базовая высота (150мм для Toyota Camry)
  - Лонжероны: 2.0x-2.2x высоты порогов
  - Поперечины: на уровне порогов

### Измерения
- Ввод фактических размеров после ДТП
- Автоматический расчет отклонений
- Визуальное сравнение с заводскими параметрами
- Контрольные точки для точных измерений (A-M)
- Цветовая индикация степени отклонений:
  - Зеленый: в пределах нормы
  - Оранжевый: предупреждение
  - Красный: критическое отклонение

### Адаптивная модель каркаса
- Математическая генерация каркаса на основе параметров:
  - Колесная база (wheelbase)
  - Колея (track width)
  - Высота порогов (sill height)
  - Передний и задний свесы
- Возможность создания деформированной версии для сравнения
- Поддержка различных моделей автомобилей

### Отчеты
- Генерация PDF отчетов (в разработке)
- Экспорт данных в CSV
- История измерений